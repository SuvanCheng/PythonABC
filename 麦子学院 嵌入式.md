

# 物联网开发系列课程之 零基础玩转Cortex-M系列CPU 嵌入式系统开发

L1：ARM及Cortex-M系列CPU简述

 课后作业：
1给出以下一个案例及备选CPU 请问案例中的几个终端和节点设备该如何进行选型？
备选CPU如下：
1 STM32F050 （Cortex-M0）
2 STM32F100 （Cortex-M3）
3 STM32F407 （Cortex-M4）
4 S3C6410 (ARM11)
5 Exynos5250

某煤矿公司为了提高矿下施工的安全性，需要在矿下配置安全预警及灾后救援辅助系统，该系统组成框图如下

其中，传感器节点用于采样矿下各个位置的温度，湿度，人体接近等信息，并通过近距局域网把信息发送给数据集中节点。其特点是数量多，要求成本低。

数据集中节点汇总各传感器节点的数据，并通过WIFI上传到信息处理服务器。要求有较强的无线传输能力。

音视频采集节点用于采集图像和声音等信息，通过WIFI上传到信息处理服务器。 要求有较强的无线传输能力和音视频处理能力。

地面手持监控终端用于显示井矿下的各项数据及声音和图像信息。



2 到MDK官网下载版本为5.0的MDK工具  并安装后熟悉开发环境 


2.1.1 浅谈ARM

 


2.1.1.1 △什么是ARM

1 ARM是一家公司
1990年 成立于英国剑桥 Acorn技术入股 苹果和VLSI资金入股 靠出售芯片的IP核授权来盈利 

Tip1：什么是IP核
知识产权核 是一段具有特定电路功能的硬件描述语言程序

授权厂家举例

.厂家名                                    	典型产品                                    

三星                                      	2410 6410 S5PC210  Exynos4412 Exynos5250

Intel(Marvel)                           	PXA2XX PXA3XX PXA9XX                    

高通                                      	骁龙S1 S2 S3 S4                           

ST                                      	STM32F050 STM32F100 STM32F407           

TI         	OMAP系列 流明系列

.2 ARM是一种CPU的体系架构

 Tip2：ARM支持的指令集
ARM指令集+Thumb指令集

Tip3：ARM早期命名规则简析
（1）ARM=Advanced RISC Machines
（2）ARM7TDI-S  

 


2.1.1.2 △ARM体系架构CPU的特点

1 体积小

2  功耗低

3  成本低

4  性能高

5  集成度高

6  种类繁多  应用广泛


2.1.1.3 △ARM体系架构CPU应用举例

1  高端应用


2  低端应用

 


2.1.1.4 △ARM体系架构及指令集的发展历程

1 起始
第一个版本 1985年 ARM1    
第一个量产版本  1986年 ARM2

2 爆发式的后续发展 (始于1997年推出ARM9)

3 Cortex系列的时代
Cortex-A
Cortex-R
Cortex-M


Tip1：如何获取更多关于ARM的知识
1：ARM官网
2：百度

 


2.1.2 ●初识Cortex-M系列CPU





2.1.2.1 △Cortex系列架构简介

ARM公司在经典处理器ARM11以后的产品改用Cortex命名，
并分成A、R和M三类，旨在为各种不同的市场提供服务。
 Cortex系列架构采用ARMv7指令集
其中
“A”系列面向尖端的基于虚拟内存的操作系统和用户应用；
“R”系列针对实时系统；
“M”系列针对低功耗低成本的微控制器应用；



2.1.2.2 △Cortex-M系列架构简介

Cortex-M系列CPU树立了全球微控制器（MCU）的设计标准。

1 特点
低成本
低功耗
对代码需求更小
代码可重用性好
性能强大
可选厂家和型号多

Tip1：8位 16位 32位的MCU

2 针对市场
成本和功耗敏感的MCU和终端应用  
用更高的性能，更低的功耗和成本慢慢取代传统8位，16位MCU在市场中的地位。并在新兴的物联网市场占据主要地位。




3 发展路线图

Cortex-M0+ 2012.3
Cortex-M7 2014.9



2.1.2.3 △Cortex-M系列家族三兄弟的特性


         	Cortex-M0	Cortex-M3	Cortex-M4

指令集                             	V6M的 Thumb,Thumb-2系统指令          	v7M的 Thumb + Thumb-2            	v7ME Thumb + Thumb-2,DSP,SIMD,FP

DMISP/MHz                       	0.9                             	1.25                            	1.25                            

总线接口                            	1                               	3                               	3                               

集成NVIC                          	是                               	是                               	是                               

中断数                             	1-32 + NMI                      	1-240 NMI                       	1-240 + NMI                     

中断优先级                           	4                               	8-256                           	8-256                           

断点，观察点                          	4/2/0,2/1/0                     	8/4/0,2/1/0                     	8/4/0,2/1/0                     

存储器保护单元（MPU）                    	否                               	是（可选）                           	是（可选）                           

集成跟踪选项（ETM）                     	否                               	是（可选）                           	是（可选）                           

单周期乘法                           	是（可选）                           	是                               	是                               

硬件除法                            	否                               	是                               	是                               

WIC支持                           	是                               	是                               	是                               

Bit Banding                     	否                               	是                               	是                               

单周期 DSP/SIMD                    	否                               	否                               	是                               

硬件浮点                            	否                               	否                               	是                               

总线协议                            	AHB Lite                        	AHB Lite,APB                    	AHB Lite,APB                    

CMSIS支持                         	是                               	是                               	是                               

应用                              	“8/16 位”应用                      	“16/32 位”应用                     	“32 位/DSC”应用                    

特性                              	低成本和简单性                         	性能效率                            	有效的数字信号控制                       



2.1.2.4 ★众里寻他千百度-谈谈CPU的选型

如何进行CPU（或者MCU）的选型
第一步：弄清楚项目需求
第二步：根据项目需求从以下几个方面进行选型
可以进行供货的CPU厂家或者代理商
CPU的工作温度范围 存储温度范围
CPU的性能（频率 架构）
CPU的功耗
CPU支持的接口
CPU的价格
CPU的上市时间及供货周期

 Tip1：芯片的环境温度级别
商业级  工业级  车规级

Tip2：如何获取更多ARM的信息


2.2 Lesson2：工欲善其事 必先利其器

 课后作业：
1给出以下一个案例及备选CPU 请问案例中的几个终端和节点设备该如何进行选型？
备选CPU如下：
1 STM32F050 （Cortex-M0）
2 STM32F100 （Cortex-M3）
3 STM32F407 （Cortex-M4）
4 S3C6410 (ARM11)
5 Exynos5250

某煤矿公司为了提高矿下施工的安全性，需要在矿下配置安全预警及灾后救援辅助系统，该系统组成框图如下

其中，传感器节点用于采样矿下各个位置的温度，湿度，人体接近等信息，并通过近距局域网把信息发送给数据集中节点。其特点是数量多，要求成本低。

数据集中节点汇总各传感器节点的数据，并通过WIFI上传到信息处理服务器。要求有较强的无线传输能力。

音视频采集节点用于采集图像和声音等信息，通过WIFI上传到信息处理服务器。 要求有较强的无线传输能力和音视频处理能力。

地面手持监控终端用于显示井矿下的各项数据及声音和图像信息。



2 到MDK官网下载版本为5.0的MDK工具  并安装后熟悉开发环境 


2.2.1 MDK简介及下载安装

 


2.2.1.1 △MDK-ARM简介

1 MDK-ARM 是什么
全称Keil_ Microcontroller Development Kit for ARM
RealView MDK-ARM开发套件源自德国Keil公司，是ARM公司目前推出的针对各种嵌入式处理器的可视化软件开发工具。支持ARM7，ARM9，ARM Cortex-M，ARM Cortex-R等多种架构处理器

2 MDK-ARM的功能
提供可视化源代码编辑环境
提供可视化的工程管理器
整合了C/C++的编译器，汇编器，链接工具，MAKE工具，通过可视化的界面可直接进行汇编，编译，连接以及生成目标文件
支持多种CPU（1000种以上）的启动代码，以及它们的编译和调试
提供软件模拟调试及仿真功能，能实现多种接口的软仿真
支持多种下载和调试工具，连接下载工具后可直接实现板级的调试
提供Flash编程及下载工具，连接下载器后可直接把程序下载入Flash Rom
提供丰富的数据手册，帮助文档

3 MDK-ARM新版本
 2014年，uVersion5发布
最新版本MDK-ARM uVision5.13



 


2.2.1.2 △MDK-ARM5.13的下载及安装

1 MDK-ARM5.13的下载


2 MDK-ARM5.13的安装



 


2.2.1.3 ☆MDK-ARM5.13介绍

1 MDK5-ARM架构介绍
MDK5-ARM 架构图如下：


Tip1：什么是CMSIS
The Cortex microcontroller software interface standard
由ARM制定 允许软件公司和芯片公司遵循一个标准的结构来发布基于Cortex-M处理器的软件方案


2 MDK5-ARM的特点
提供大量的软件组件，并可随时更新最新的组件，提高开发效率
增加了包管理功能，用户可定制需要的CPU支持包或者软件组件包
提供大量的代码模板，方便工程师快速开发
在MDK5.0中的一些外设驱动采用 CMSIS-Driver标准的驱动，软件兼容性好，提高代码复用的能力
优化了编译器，编译速度比版本4更快
通过MDK5的开发环境，可方便的访问各类技术文档



3 MDK-ARM5.13安装后的目录介绍  









 


2.2.1.4 ☆MDK-ARM5.13开发环境讲解

MDK-ARM5.13开发环境介绍







 


2.2.2 MDK使用方法及其它一些工具介绍（1）

 


2.2.2.1 ☆MDK5.13包管理器介绍及使用

1  MDK5.13包管理器介绍及使用











2.2.2.2 ☆使用MDK5.13开发流程及配置介绍





2.2.3 MDK使用方法及其它一些工具介绍（2）

 


2.2.3.1 ☆MDK5.13工程的创建及代码的添加



1 创建第一个工程

2 加入代码

 


2.2.3.2 ☆MDK5.13工程的编译演示

1 代码的的编译



2.2.4 MDK使用方法及其它一些工具介绍（3）

 课后作业
1  请大家用MDK创建一个基于芯片STM32F407ZG的工程，并添加代码，进行编译，通过软仿真进行调试。要求启动代码用课程讲解的第二种方法添加。

2  请大家下载Source Insight   UE    串口助手  以及文件比较器Beyond  Compare  这些工具在我们后续的课程会用到


2.2.4.1 ☆MDK5.13工程代码的调试演示

1 代码的调试演示



2.2.4.2 ☆工程代码的基本构成

1 Cortex-M架构CPU工程代码的基本构成

 


2.2.4.3 ☆MDK5.13编译流程简介及编译后文件说明


1 代码的编译流程

2 生成的文件说明



2.2.4.4 ☆如何获取更多的信息

1 如何使用帮助文档

2 如何使用及设置BOOK Window



2.2.4.5 ★其它的一些工具

1 代码查看和编辑
UE
Source Insight

2 接口工具
串口助手
网口助手

3 文件比较器
Beyond Compare

4 代码编译
gcc
IAR

 


2.3 Lesson3：探索Cortex-M系列CPU的内核

课后作业
请同学们下载以下资料进行阅读



2.3.1 ●Cortex-M内核架构及指令集简述

 


2.3.1.1 △Cortex-M三兄弟体系架构概述

Cortex-M0 Cortex-M3 Cortex-M4 的体系架构图



Tip1：何谓哈佛架构





2.3.1.2 ☆Cortex-M三兄弟指令集简述

1 复习下ARM指令集的发展史

2 Cortex-M架构三兄弟的指令集以及THMUB指令集的包含关系


3 Cortex-M架构三兄弟指令集的包含关系以及方便的可移植性



 


2.3.2 ●简单学习ARM汇编语言

 


2.3.2.1 ☆简单学习ARM汇编语言

1 ARM汇编语言的基本语法
标号
操作码 操作数1, 操作数2, … ; 注释。

2 常用的汇编指令介绍及使用演示
数据传输指令
​    
   MOV指令使用演示

内存访问指令
​    
  LDR /STR指令使用演示

程序流控制指令（跳转指令）


 BL指令使用演示

 算术指令
​    

   

逻辑指令
​    


3  ARM汇编语言的后缀

   







2.3.2.2 ★Cortex-M架构CPU中汇编和C的混合编程

1 汇编代码中调用C函数


2 C代码中调用汇编函数
tip1：如何写一个汇编函数

3 C代码中直接加入汇编语句
嵌入的汇编语句
内联的汇编语句



2.3.3 ●Cortex-M架构CPU内核的寄存器及处理器模式

 


2.3.3.1 ☆Cortex-M架构CPU内核寄存器

1 内核寄存器图示


要特点说明的几个寄存器
R13 MSP/PSP
R14 LR
R15 PC

2 特殊寄存器
程序状态寄存器 xPSR

编程状态寄存器

不同架构下编程状态寄存器的比较

中断和异常屏蔽寄存器PRIMASK, FAULTMASK, BASEPRI



控制寄存器

不同架构下控制寄存器的比较


3  MDK-ARM5.13的仿真演示



2.3.3.2 ☆Cortex-M架构CPU处理器操作状态，模式和特权级别

1 操作状态
Debug 状态
Thumb 状态

2 特权等级和操作模式
两种特权等级
特权级
非特权级 用户级
两种操作模式
Handler 模式
Thread （线程）模式


3 各状态和各模式及等级间的切换





特权级和处理器模式的改变图

4 MDK-ARM5.13的仿真演示







2.3.4 ●Cortex-M架构CPU内核的存储系统

 


2.3.4.1 ☆存储系统的特性

1 存储系统的主要特性
4GB的线性寻址空间
预定义好的存储器映射
支持大端模式和小端模式
支持位带访问（可选）
支持存储器保护单元（可选）
支持非对齐的传输


Tip1：4GB寻址空间的由来

Tip2：关于大端模式和小端模式

Tip3：对齐传输和非对齐传输











2.3.4.2 ☆存储系统的映射图


1  存储系统映射图简析

 


2.3.4.3 ☆堆栈存储模型

1  何谓堆栈，堆栈在编程模型中的功能

2   Cortex-M架构中堆栈的实现 

3   MDK-ARM5.13的仿真演示


2.3.5 ●Cortex-M架构CPU内核的中断和异常处理

 


2.3.5.1 ☆中断和异常的概念

1 何谓异常，何谓中断？



2 异常的类型


3 常见的中断来源

Tip1：Cortex-M架构CPU的中断和ARM7架构中断的区别





2.3.5.2 ☆异常的处理流程

1 异常的处理流程
判断异常是否符合处理条件
异常的响应处理序列
异常的处理Handle
异常的返回处理序列

Tip1 中断向量表



2.3.5.3 ☆NVIC简介

1 何谓NVIC
嵌套的中断向量控制器

2 NVIC的功能
灵活的中断和异常管理
嵌套的中断/异常支持
中断/异常向量表入口加载支持

Tip1：可以屏蔽中断的内核特殊寄存器组
PRIMASK
FAULTMASK
BASEPRI



2.3.6 ●Cortex-M架构CPU的复位及复位时序

 


2.3.6.1 ☆三种复位方式

1 上电复位

2  系统复位

3  处理器复位











2.3.6.2 ☆复位时序描述


Tip1:异常向量表起始位置（即0地址处）存放主堆栈指针的原因


2.3.6.3 ☆启动代码讲解

1 启动代码的主要功能
堆栈空间定义；
存放中断向量表；
复位中断函数（Reset_Handler）;
其它中断异常服务函数，以及弱[WEAK]声明；
将堆栈地址传递给库函数，利用库函数初始化堆栈，和库函数自身初始化。

Tip1：为什么使用以前的8位，16位MCU，不用编写启动代码？

2 ST官方提供的Cortex-M4启动代码简单分析





2.4 Lesson4：实验课程前的准备

课后作业
请同学们下载并熟悉芯片资料和开发板


2.4.1 软件的准备工作

 


2.4.1.1 ☆开发环境的构建

1 安装开发工具
MDK-ARM 5.13

2 安装支持包
STM32F407ZG

3 其它需要的软件工具
串口助手
UE
Source  Insight


2.4.1.2 ☆需要准备的开发资料

1 CPU的DATASHEET(数据手册)

2 CPU的编程参考手册

3 其它外围芯片的数据手册

4  一些接口原理资料


2.4.1.3 ★嵌入式开发必知会之一---如何看DataSheet和编程手册

1 一起来看看MCU的芯片手册


2 一起来看看MCU的编程手册

 


2.4.2 硬件的准备工作

 


2.4.2.1 ☆需要哪些硬件工具

1 开发板

2 仿真器
下载程序  调试程序
J-LINK

3 USB线及串口线

4 电源适配器

5 其它工具
万用表   示波器



2.4.2.2 ☆开发板介绍和展示

1 开发板介绍
STM32F407ZGT6   CORTEX-M4


2 开发板展示



2.4.2.3 ★嵌入式开发必知会之二---如何看电路原理图

1  如何看原理图

2  如何看PCB







-------------------------------------------------------------
3 第三阶段-初级实验
-------------------------------------------------------------


3.1 Lesson5：不一样的点灯实验---学习I/O的输出

 课后作业：
1：如何写一个更加通用移植性更好的控制灯的函数


2：通过本节课学习的内容，结合板上蜂鸣器的电路，实现一个小型的告警系统，要求蜂鸣器周期性的响2S，停5S。使用CMSIS提供的延时函数。



3.1.1 ●点灯的理论基础

 


3.1.1.1 ★嵌入式开发必知会之三---了解LED

LED的功能，特点和用途
发光二极管   


LED的工作原理


LED的电路符号表示


 课后作业：请同学们课后了解电阻，电容和电感的功能，特点，用途及电路符号表示


3.1.1.2 ☆点灯的电路图分析

1 一起看看点灯的电路图


Tip1：另一种点灯的电路


3.1.1.3 ☆STM32F407中GPIO的特性及操作方法

1 STM32F407中GPIO的特性

Tip1：如何访问外设的寄存器

2 STM32F407中操作GPIO的方法
输出的配置
高低电平的配置


3.1.2 ●通过直接操作寄存器实现点灯实验

思考题
如何更好的提高代码的可读性，可移植性



3.1.2.1 ☆实验的需求分析（实验目的）

1 实验目的
学会基本的硬件操作---I/O的输出高低电平操作
学习利用系统时钟实现较为精确的延时
学习规范的模块化编程
学会使用CMSIS的支持库


3.1.2.2 ☆通过直接操作寄存器实现点灯代码

1 程序流程分析
如何利用系统时钟实现较为精确的延时
如何初始化I/O
Tip1：硬件编程的基本流程

2 代码实现及分析


3.1.2.3 ☆代码下载及调试演示

3.1.3 ●通过使用CMSIS库函数实现点灯实验





3.1.3.1 ☆通过使用CMSIS库函数实现点灯代码


 1    如何使用CMSIS

2    如何利用CMSIS库操作I/O


3.1.3.2 ☆代码下载及调试演示

3.1.3.3 ☆两种代码的比较

两种实现方法的比较
更好的可移植性
更好的可靠性
代码占用的空间更大
更好的使用性


3.2 Lesson6：按键实验---学习I/O的输入及中断的编程

 课后作业：
1：预习编程手册关于USART控制器的描述 第30章

2：通过中断的方式实现一个程序，要求按下KEY1以后，让LED1间隔0.5S闪烁，并持续5S后关闭，实现代码并在板调试



3.2.1 ●按键的理论基础

 


3.2.1.1 ☆实验的需求分析（实验目的）

实验目的
了解按键的工作原理及电原理图
了解STM32F407中I/O输入信号读取的原理
了解STM32F407中外部中断的原理
学习利用CMSIS实现I/O输入信号读取的编程
学习利用CMSIS实现外部中断的编程
简单学习工程的移植


3.2.1.2 ★嵌入式开发必知会之四---了解按键

1 按键功能及用途，常见按键举例


2 按键的工作原理


3 按键的电路表示 


课后小作业：
请大家课后百度现在流行的触摸式按键的相关信息，并考虑如果使用我们开发板的CPU如何操作触摸按键。


3.2.1.3 ☆按键的电路图分析

1 一起看看按键电路

 


3.2.1.4 ☆STM32F407中如何读取I/O的输入信号

1 STM32F407如何配置I/O为输入

2  STM32F407如何读取输入信号





3.2.1.5 ☆STM32F407中如何使用外部中断

1 STM32F407对中断的编程方法
初始化中断源
使能中断源
实现中断服务程序  Interrupt  Handler  Weak

 


3.2.2 ●通过轮询实现按键捕获实验





3.2.2.1 ★如何利用已有的工程创建新工程

3.2.2.2 ☆通过轮询实现按键捕获代码实现及分析

1 代码的流程分析

2  代码的实现


3.2.2.3 ☆代码的下载，调试及演示

  



3.2.3 ●通过外部中断实现按键捕获实验





3.2.3.1 ☆通过外部中断实现按键捕获代码的实现及分析

1 代码的流程分析

2 代码的实现 

Tip1：函数说明的格式

Tip2：如何使用CMSIS的延时


3.2.3.2 ☆代码的下载，调试及演示

  



3.2.3.3 ☆两种代码的比较

两种实现按键操作代码的比较
中断模式对CPU占用率更小  等待时间更短


3.3 Lesson7：第一个通信实验---学习串口的编程

 课后作业：
课后作业：
基础作业
作业1：通过本课的讲解，请同学们结合我们的实验代码，画出代码的执行流程图和函数间的调用关系图，并且要理解中断和主程序是如何进行信息传递的，再思考下还有没有更好的方式进行信息的传递。

作业2：使用轮询的方式实现接收PC机发送过来的数据，并将接收到的数据发送至PC机的串口助手中。要求在中断例程的代码中进行修改，使用条件编译进行编译。

进阶作业
作业3：百度DMA的概念及功能，阅读STM32F407中第10章DMA控制器的描述和30.3.13小节 （使用DMA进行数据的连续通信）的内容。参考并使用CMSIS串口库中使用DMA进行初始化及收数据的函数，实现通过DMA进行数据的接收功能。


选做实验
有台式机的同学可以直接使用公转母的串口线，将开发板COM2或者COM3接口和PC端的串口连接（了解SP3232的芯片手册），在开发板上实现COM2或者COM3收发数据的编程，并通过PC端的串口助手进行收发实验。





3.3.1 ●串口的理论基础

 


3.3.1.1 ☆实验的需求分析（实验目的）

1 实验目的
了解串口的概念和功能
了解USB转串口芯片CH340G以及串口电平转换芯片SP232，能够看懂串口的电原理图
了解STM32F407中串口控制器的特性
学会使用CMSIS库函数对串口控制器编程，实现串口的收发功能
学会利用开发板下载调试以上编程的代码


3.3.1.2 ★嵌入式开发必知会之五---了解串口

1 串口的概念，功能及用途

Tip1：几个和串口相关名词的解释
USART
UART
RS232


2 串口中不同的电平信号
TTL电平
RS232电平

3 嵌入式开发中其它常用的接口

课后小作业：
1  请大家课后百度RS422和RS485串口，比较和我们使用的RS232串口有什么不同
2 请大家百度并了解串口的工作原理


3.3.1.3 ☆串口电路图分析

1   一起看看串口电路


2  TTL转RS232接口芯片SP232介绍


3 串口转USB接口芯片CH340G介绍


3.3.1.4 ☆STM32F407中串口控制器的特性



 


3.3.1.5 ☆STM32F407中如何使用串口控制器

1  初始化I/O
2  初始化控制器  
3  初始化串口中断

 


3.3.2 ●串口初始化及发送代码的实现分析





3.3.2.1 ☆串口发送代码的实现及分析

1 一起看看CMSIS的串口库函数

2 代码的流程分析
初始化   
初始化I/O   配置时钟   NVIC控制器
初始化 串口控制器  



3 代码的实现

Tip1：如何通过Printf打印指定串口的输出信息


3.3.3 ●串口接收代码的实现分析及在板演示





3.3.3.1 ☆串口接收代码的实现及分析

1  代码的流程分析

2  代码的实现 

Tip1：条件编译的妙用


3.3.3.2 ☆代码的下载，在板调试及演示

1 实验平台的构成


2 串口助手介绍及使用

Tip1：CH340驱动的安装

3 代码的下载及演示  



3.4 Lesson8：时间和MCU的自复位---学习定时器和看门狗

 课后作业：
利用开发板实现如下功能，利用定时器定时1S进行串口的输出，要求输出”系统运行“四个字。并且进行串口数据的接收，如果收到了”RESET“（大小写均可）字符，则利用看门狗将开发板复位。



3.4.1 ●实验理论基础

 


3.4.1.1 ☆实验的需求分析及实验目的

1 实验的需求分析
使用定时器实现定时的点灯，要求LED1亮1S，灭1S；
在以上代码中加入看门狗，分别观察喂狗和不喂狗时程序的运行情况；

2 实验目的
了解看门狗的功能及工作原理
了解定时器的功能及工作原理
了解STM32F407中看门狗和定时器的特性
学会使用CMSIS库函数对看门狗和定时器进行编程
学会利用开发板下载调试以上编程的代码



3.4.1.2 ★嵌入式开发必知会之六---了解定时器和看门狗

1 看门狗的功能及用途

2 看门狗电路模型及工作原理

3 定时器的功能及用途

4 定时器的工作原理



3.4.1.3 ☆STM32F407中定时器的特性

1 STM32F407定时器的特性





3.4.1.4 ☆STM32F407中看门狗的特性

1 STM32F407中看门狗的特性



3.4.2 ●定时器实验代码的实现分析及演示





3.4.2.1 ☆定时器代码的实现及分析


1代码的流程分析
初始化流程
中断服务程序的实现

2 一起看看CMSIS中定时器的库函数


3 代码的实现


3.4.2.2 ☆代码的下载，在板调试及演示

  



3.4.3 ●看门狗实验代码的实现分析及演示





3.4.3.1 ☆看门狗代码的实现及分析

1 代码的流程分析

2 一起看看CMSIS中看门狗的库函数

3 代码的实现



3.4.3.2 ☆代码的下载，在板调试及演示

  



-------------------------------------------------------------
4 第四阶段-进阶实验
-------------------------------------------------------------


4.1 Lesson9：第一个传感器---温度传感器DHT11实验

 课后作业：
1：在完成课堂实验的基础上，请同学们查看温度传感器DS18B20的芯片手册，通过MDK-ARM和开发板实现对传感器DS18B20采用到的温度数据进行读取，并通过串口打印到PC端的串口助手上。



4.1.1 ●温度传感器DHT11实验的理论基础

 


4.1.1.1 ☆实验需求及实验目的

1 实验的需求分析
使用单总线接口读取温湿度传感器DHT11采集到的温度和湿度数据；
通过串口打印出温湿度数据到PC端的串口助手,1S打印一次数据；

2 实验目的
了解DHT11的内部组成，功能及工作原理
了解常见外设的硬件接口
学会看信号的时序图
学会利用GPIO操作的CMSIS库函数对DHT11进行编程
学会利用开发板并下载调试以上编程的代码


4.1.1.2 ★嵌入式开发必知会之七---常见的硬件接口和时序图的学习

1 常见的硬件接口
单总线接口
SPI接口
I2C接口
UART接口
并行接口



2 如何看时序图
信号的定义  信号是高有效还是低有效   信号采用的时机


4.1.1.3 ☆DHT11简介

1 一起来看看DHT11的DATASHEET



4.1.2 ●DHT11实验代码的分析实现及演示

思考题
如何更好的提高代码的可读性，可移植性



4.1.2.1 ☆DHT11编程接口讲解

1 DHT11的电原理图
pg9   

2 单总线接口的编程方式
配置I/O输出    
配置I/O输入
拉高  拉低 
读I/O

3 DHT11单总线接口的协议说明


4.1.2.2 ☆实验代码的分析及实现

1  代码流程分析
I/O口输入 输出配置
延时操作 us级别延时
协议的实现

1 初始化DHT11
io的初始化
检测DHT11
2  读取数据  

2  代码的具体实现


4.1.2.3 ☆代码下载及调试演示

4.2 Lesson10：检测亮与暗---ADC接口与光线传感器实验

 课后作业：
1 在课堂实验的基础之上，分别使用中断模式和DMA模式实现光线强度的读取

2 了解STM32F407内部温度传感器，实现内部温度的读取



4.2.1 ●嵌入式开发必知会之七---物联网的感觉器官(传感器)理论基础

 


4.2.1.1 ☆传感器的功能及常见的传感器

1 传感器的功能


2 常见的传感器
视觉---光敏传感器  
听觉---声敏传感器
嗅觉---气敏传感器
味觉---化学传感器
触觉---压敏  温敏  流体


4.2.1.2 ☆传感器的主要组成

1 传感器的主要组成



 


4.2.1.3 ☆传感器的工作原理

1 传感器的主要工作原理



4.2.1.4 ☆传感器的编程接口

1 常见的传感器编程接口
模拟接口    电压   电流    ADC接口  
数字接口    单总线   I2C   SPI   USB    串口

 


4.2.1.5 ☆传感器实物展示

1 传感器实物展示



4.2.2 ●ADC与光敏传感器实验的理论基础

思考题
如何更好的提高代码的可读性，可移植性



4.2.2.1 ☆实验需求及实验目的

1 实验需求分析
通过ADC接口对光敏二极管上变化的电压进行检测
将电压值转换成光强度的百分比，并通过串口进行打印

2 实验目的介绍
了解光敏传感器的功能和应用；
了解光敏电阻的组成，工作原理；
了解ADC接口的功能及特性；
学会使用CMSIS库函数对ADC接口进行编程；
完成在板实验，对ADC接口进行在板调试；



4.2.2.2 ☆光敏传感器简介

1 光敏二极管的电路表示


2 光敏二极管的内部组成及工作原理


3 光敏二极管的主要应用




 Tip1：常见的光敏传感器


4.2.2.3 ☆STM32F407中的ADC接口简介

1 ADC接口的主要功能及应用



2 一起看看STM32F407数据手册关于ADC接口的介绍
分辨率  8   10  12   
量程 
采样速率  
精度  





4.2.2.4 ☆实验电路分析

1  一起看看ADC及光敏二极管的电路图


2  电路工作原理分析


4.2.3 ●ADC与光线传感器实验代码分析，实现及运行演示

思考题
如何更好的提高代码的可读性，可移植性



4.2.3.1 ☆实验代码的分析及实现

1 实验代码的几个关键点
I/O的初始化  
ADC3_IN5的初始化
亮度百分比的计算

2 实验代码的流程分析


3 一起看看CMSIS下的ADC操作库函数

4 代码的具体实现


4.2.3.2 ☆代码下载及调试演示

4.3 Lesson11：降低MCU的功耗和时间记录---低功耗模式和RTC实验

 课后作业：
1：在完成课堂实验的基础上，请同学们在RTC中使用周期性的可编程唤醒中断，从而在待机后可以实现定时的唤醒。

2：在课堂实验的基础上，将进入待机状态改为进入睡眠（停止）状态。请同学们自行实现该代码。


4.3.1 ●实验的理论基础

 


4.3.1.1 ☆实验需求及实验目的

1 实验的需求分析
实现设置和读取RTC的操作；
程序启动后，设置一次RTC的值，并反复进行读取，当读到秒为59时，让MCU待机；
通过key_up键可以唤醒系统；

2 实验目的
了解MCU低功耗模式意义
了解STM32F407的几种低功耗模式
学会通过使用CMSIS库函数实现MCU的待机及唤醒
了解RTC的功能及原理
了解STM32F407中RTC的操作方法
学会通过使用CMSIS库函数实现RTC的设置和读取
在开发板上具体实现待机唤醒及RTC的操作


4.3.1.2 ★嵌入式开发必知会之八---MCU低功耗模式的意义

1 MCU低功耗模式的意义




2 其它降低功耗的方法

 


4.3.1.3 ★嵌入式开发必知会之九---RTC的功能和工作原理

1 何谓RTC，RTC的功能



2 RTC的工作原理


4.3.1.4 ☆STM32F407的几种低功耗模式


1 STM32F407中的低功耗模式





4.3.1.5 ☆STM32F40中RTC的特性

1 STM32F407中RTC的特性 


4.3.2 ●待机唤醒实验代码的分析实现

思考题
如何更好的提高代码的可读性，可移植性



4.3.2.1 ☆进入待机的方法及相关硬件分析

1 如何使MCU进入待机状态


2 相关的电原理图分析





4.3.2.2 ☆实验代码的分析及实现


1  CMSIS提供的电源操作库函数分析

2  代码流程分析

3  代码的具体实现


4.3.3 ●RTC实验代码的分析实现及演示

思考题
如何更好的提高代码的可读性，可移植性



4.3.3.1 ☆读取和设置RTC的方法及操作流程

1 如何读取和设置STM32F407中的RTC

 


4.3.3.2 ☆实验代码的分析及实现

1  CMSIS中操作RTC的库函数分析

2  代码的流程分析及具体实现


4.3.3.3 ☆代码下载及调试演示

4.4 Lesson12：数据的仓库---SPI接口和FLASH存储器实验

 课后作业：

 


4.4.1 ●嵌入式开发必知会之十---物联网终端的数据仓库（存储器）理论基础

 


4.4.1.1 ☆嵌入式存储器的功能及常见的存储器

1 嵌入式系统中存储器的主要功能
RAM 
ROM


2 嵌入式系统中常见的存储器
SRAM
SDRAM
SD卡  NAND FLASH
NOR FLASH
EEPROM


4.4.1.2 ☆存储器的内部组成及工作原理

1 存储器的内部组成


2 存储器的工作原理



4.4.1.3 ☆存储器的编程接口

1 常见存储器的编程接口
串行接口
并行接口



4.4.1.4 ☆存储器实物展示

1 常见存储器的实物展示



4.4.2 ●SPI接口与FLASH存储器实验的理论基础

思考题
如何更好的提高代码的可读性，可移植性



4.4.2.1 ☆实验需求及实验目的

1 实验需求分析
实现通过SPI接口对FLASH存储芯片W25Q128的操作；
实现对W25Q128是否存在的检测；
实现对W25Q128的数据读取操作，通过按下按键1执行读操作，通过串口将读取到的数据打印在屏幕上；
实现对W25Q128的数据写入操作，通过按下按键2执行写操作，写入固定长度和内容的数据；

2 实验目的介绍
了解串行接口存储器W25Q128的特性，I/O以及编程接口；
了解SPI接口的功能以及STM32F407中SPI接口的特性；
学习SPI接口的编程方式（使用CMSIS库函数）；
学习通过SPI接口对存储芯片W25Q128进行检测以及读写操作；
对以上内容进行在板调试；


4.4.2.2 ☆FLASH存储器W25QXX简介

1 W25QXX的管脚介绍


2 W25QXX的内部组成及工作原理


3 W25QXX的编程接口


4 W25QXX的主要应用

 


4.4.2.3 ☆STM32F407中的SPI接口简介

1 SPI接口的主要功能



2 一起看看STM32F407数据手册关于SPI接口的介绍


4.4.2.4 ☆实验电路分析

1  一起看看SPI接口及W25QXX的电路图


2  电路工作原理分析


4.4.3 ●SPI接口与FLASH存储器实验代码分析，实现及运行演示

思考题
如何更好的提高代码的可读性，可移植性



4.4.3.1 ☆实验代码的分析

1 实验代码的几个关键点

2 实验代码的流程分析

3 一起看看CMSIS下的SPI操作库函数

tip：如何把官方的中间库变成自己的库



4.4.3.2 ☆实验代码的具体实现

1 代码的具体实现

tip：SPI接口读写时序分析



4.4.3.3 ☆代码下载及调试演示

-------------------------------------------------------------
5 第五阶段-高阶实验
-------------------------------------------------------------


5.1 Lesson13：物联网终端的高级显示---FSMC接口与LCD实验

 课后作业：
1：在完成课堂实验的基础上，请同学们查看温度传感器DS18B20的芯片手册，通过MDK-ARM和开发板实现对传感器DS18B20采用到的温度数据进行读取，并通过串口打印到PC端的串口助手上。



5.1.1 ●LCD实验的理论基础

 


5.1.1.1 ☆实验需求及实验目的

1 实验的需求分析
通过对FSMC接口编程，实现液晶屏的初始化及显示；

2 实验目的
了解液晶屏的组成及工作原理
了解FSMC接口的应用
学会液晶屏的初始化及操作流程
学会使用FSMC接口编程的CMSIS库函数
学会利用开发板并下载调试以上编程的代码


5.1.1.2 ☆LCD组成及工作原理简介

1  LCD的组成


2  LCD的工作原理



 


5.1.1.3 ☆LCD的编程接口及编程原理

1  常见的LCD的编程接口
串行
并行接口    RGB接口 5 6 5    差分信号  LVDS
串行+并行  

2  LCD的编程原理
  MCU   对 控制芯片  

3 一起看看LCD内的芯片资料

tip：LCD常用的参数 
分辨率
颜色位数
背光亮度





 


5.1.1.4 ☆LCD的硬件电路分析

1   一起看看LCD的原理图

2   LCD管脚功能分析







5.1.1.5 ☆FSMC接口应用简介及STM32F407下的FSMC接口

1  FSMC接口的应用
灵活 的静态存储控制器   总线接口 
液晶屏    数据线   
存储器


2  一起看看STM32F407中的FSMC



5.1.2 ●LCD实验代码的分析实现及演示

思考题
如何更好的提高代码的可读性，可移植性



5.1.2.1 ☆LCD的编程分析

1  LCD编程的关键点分析
实现LCD的初始化
实现对LCD数据的读写 
实现对背光的控制

2  LCD的初始化流程分析


3 如何对LCD进行数据的读写

tip1：8080接口编程说明

tip2：80接口16位数据格式说明 


5.1.2.2 ☆FSMC接口的CMSIS库函数分析

1  一起看看CMSIS提供的FSMC操作库函数 


2  LCD地址映射的说明 



5.1.2.3 ☆实验代码的具体实现

1  代码流程分析

2  一起看看LCD试验的代码

 tip：如何让代码能够自适应硬件


5.1.2.4 ☆代码下载及调试演示

5.1.3 ●LCD实验高阶内容---汉字的显示 

思考题
如何更好的提高代码的可读性，可移植性



5.1.3.1 ☆在LCD上显示汉字的原理分析  

1 在LCD上显示汉字的基本原理 

 


5.1.3.2 ☆如何生成字符的点阵数组  

1  生成点阵数组的工具介绍 


2  生成点阵数组的方法



5.2 Lesson14：物联网终端设备的运动监测---I2C接口与运动传感器MPU6050实验

 课后作业：
1：



5.2.1 ●实验的理论基础

 


5.2.1.1 ☆实验需求及实验目的

1 实验的需求分析
实现一个I2C接口，并通过该接口对MPU6050进行编程，读出该传感器的输出数据

2  实验目的分析
了解I2C的硬件接口以及信号时序
了解常见的运动传感器及应用
学习MPU6050的数据手册及编程方法
学会通过I2C接口对MPU6050进行编程
能自行完成实现I2C接口的代码及对MOU6050操作的代码
能够对以上代码进行在板的调试及验证 


5.2.1.2 ☆I2C接口的理论基础

1  I2C接口的I/O说明

2  I2C接口的信号说明

3  I2C接口的时序说明



 


5.2.1.3 ☆运动传感器MPU6050简述 

1  常见的运动传感器及应用


tip：运动传感器中的几个重要计量参数
加速计计量单位
陀螺仪计量单位
磁力计计量单位

2 一起看看MPU6050的数据手册









 


5.2.1.4 ☆MPU6050的硬件电路分析

1   一起看看MPU6050的原理图





 


5.2.2 ●实验代码的分析实现及演示

思考题
如何更好的提高代码的可读性，可移植性



5.2.2.1 ☆I2C接口的编程分析

1  实现IIC接口的几个关键点

tip：两种实现IIC接口的方法及优缺点分析


2  IIC接口的初始化流程分析


3 如何实现IIC接口的数据读写





5.2.2.2 ☆MPU6050的编程分析

1   MPU6050编程的关键点分析

2   MPU6050初始化流程分析

tip：MPU6050读写地址的确定 

3   MPU6050寄存器读写流程分析

4   MPU6050几个关键寄存器分析





 


5.2.2.3 ☆实验代码的具体实现

1  代码流程分析

2  一起看看MPU6050实验的代码

 


5.2.2.4 ☆代码下载及调试演示

5.3 Lesson15：物联网终端设备的无线通信---蓝牙模块HC-05实验

 课后作业：
1：在完成课堂实验的基础上，请同学们查看温度传感器DS18B20的芯片手册，通过MDK-ARM和开发板实现对传感器DS18B20采用到的温度数据进行读取，并通过串口打印到PC端的串口助手上。



5.3.1 ●实验的理论基础

 


5.3.1.1 ☆实验需求及实验目的

1 实验的需求分析
实现一个I2C接口，并通过该接口对MPU6050进行编程，读出该传感器的输出数据

2  实验目的分析
了解I2C的硬件接口以及信号时序
了解常见的运动传感器及应用
学习MPU6050的数据手册及编程方法
学会通过I2C接口对MPU6050进行编程
能自行完成实现I2C接口的代码及对MOU6050操作的代码
能够对以上代码进行在板的调试及验证 


5.3.1.2 ☆I2C接口的理论基础

1  I2C接口的I/O说明

2  I2C接口的信号说明

3  I2C接口的时序说明



 


5.3.1.3 ☆运动传感器MPU6050简述 

1  常见的运动传感器及应用


tip：运动传感器中的几个重要计量参数
加速计计量单位
陀螺仪计量单位
磁力计计量单位

2 一起看看MPU6050的数据手册









 


5.3.1.4 ☆MPU6050的硬件电路分析

1   一起看看MPU6050的原理图





 


5.3.2 ●实验代码的分析实现及演示

思考题
如何更好的提高代码的可读性，可移植性



5.3.2.1 ☆I2C接口的编程分析

1  实现IIC接口的几个关键点

tip：两种实现IIC接口的方法及优缺点分析


2  IIC接口的初始化流程分析


3 如何实现IIC接口的数据读写





5.3.2.2 ☆MPU6050的编程分析

1   MPU6050编程的关键点分析

2   MPU6050初始化流程分析

tip：MPU6050读写地址的确定 

3   MPU6050寄存器读写流程分析

4   MPU6050几个关键寄存器分析





 


5.3.2.3 ☆实验代码的具体实现

1  代码流程分析

2  一起看看MPU6050实验的代码

 

5.3.2.4 ☆代码下载及调试演示